<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户中心 - Aurora情感AI</title>
    <meta name="description" content="管理您的Aurora账户和数据。">
    
    <!-- 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@100;200;300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 样式 -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* 用户中心页面专用样式 */
        .dashboard-page {
            min-height: 100vh;
            background: var(--void-black);
            color: var(--pure-white);
            position: relative;
            overflow: hidden;
        }

        /* 背景效果 */
        .dashboard-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--aurora-core);
            opacity: 0.05;
            z-index: 1;
        }

        /* 导航栏 */
        .dashboard-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--glass-rainbow);
            border-bottom: 2px solid var(--glass-border);
            backdrop-filter: blur(30px);
            z-index: 1000;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-family: var(--font-grotesk);
            font-size: 24px;
            font-weight: 700;
            color: var(--pure-white);
            background: var(--aurora-core);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: var(--neural-silver);
            text-decoration: none;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 300;
            transition: all 0.3s var(--ease-expo);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-link:hover {
            color: var(--data-cyan);
            text-shadow: 0 0 10px var(--data-cyan);
        }

        .nav-link.active {
            color: var(--data-cyan);
        }

        .logout-btn {
            background: var(--aurora-core);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: var(--pure-white);
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s var(--ease-expo);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-data);
        }

        /* 主内容区域 */
        .dashboard-content {
            margin-top: 100px;
            padding: 40px;
            position: relative;
            z-index: 2;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 页面标题 */
        .page-title {
            font-family: var(--font-grotesk);
            font-size: 48px;
            font-weight: 700;
            color: var(--pure-white);
            margin-bottom: 20px;
            text-align: center;
        }

        .page-subtitle {
            font-family: var(--font-mono);
            font-size: 16px;
            font-weight: 300;
            color: var(--neural-silver);
            text-align: center;
            margin-bottom: 60px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .stat-card {
            background: var(--glass-rainbow);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(30px);
            position: relative;
            transition: all 0.3s var(--ease-expo);
        }

        .stat-card:hover {
            border-color: var(--data-cyan);
            box-shadow: var(--shadow-data);
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--aurora-core);
            border-radius: 22px;
            opacity: 0.1;
            z-index: -1;
        }

        .stat-icon {
            font-size: 32px;
            color: var(--data-cyan);
            margin-bottom: 15px;
        }

        .stat-number {
            font-family: var(--font-grotesk);
            font-size: 36px;
            font-weight: 700;
            color: var(--pure-white);
            margin-bottom: 10px;
        }

        .stat-label {
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 300;
            color: var(--neural-silver);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* 功能区域 */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .feature-card {
            background: var(--glass-rainbow);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(30px);
            position: relative;
            transition: all 0.3s var(--ease-expo);
            cursor: pointer;
        }

        .feature-card:hover {
            border-color: var(--data-cyan);
            box-shadow: var(--shadow-data);
            transform: translateY(-5px);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--aurora-core);
            border-radius: 22px;
            opacity: 0.1;
            z-index: -1;
        }

        .feature-icon {
            font-size: 32px;
            color: var(--data-cyan);
            margin-bottom: 20px;
        }

        .feature-title {
            font-family: var(--font-grotesk);
            font-size: 20px;
            font-weight: 600;
            color: var(--pure-white);
            margin-bottom: 15px;
        }

        .feature-description {
            font-family: var(--font-display);
            font-size: 14px;
            font-weight: 300;
            color: var(--neural-silver);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feature-btn {
            background: var(--aurora-core);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: var(--pure-white);
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s var(--ease-expo);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            width: 100%;
        }

        .feature-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-data);
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--glass-rainbow);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(30px);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-family: var(--font-grotesk);
            font-size: 24px;
            font-weight: 600;
            color: var(--pure-white);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--neural-silver);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s var(--ease-expo);
        }

        .close-modal:hover {
            color: var(--data-cyan);
        }

        .modal-body {
            margin-bottom: 30px;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s var(--ease-expo);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--aurora-core);
            color: var(--pure-white);
        }

        .btn-secondary {
            background: var(--glass-medium);
            color: var(--neural-silver);
            border: 1px solid var(--glass-border);
        }

        .btn-danger {
            background: rgba(255, 42, 109, 0.2);
            color: var(--pure-white);
            border: 1px solid rgba(255, 42, 109, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-data);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .dashboard-nav {
                padding: 15px 20px;
            }
            
            .nav-links {
                gap: 15px;
            }
            
            .dashboard-content {
                padding: 20px;
            }
            
            .page-title {
                font-size: 32px;
            }
            
            .stats-grid,
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 背景效果 -->
    <div class="dashboard-bg"></div>

    <!-- 导航栏 -->
    <nav class="dashboard-nav">
        <div class="nav-brand">AURORA</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">首页</a>
            <a href="dialogue.html" class="nav-link">对话</a>
            <a href="#" class="nav-link active">用户中心</a>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> 登出
            </button>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <div class="dashboard-content">
        <div class="dashboard-container">
            <h1 class="page-title">用户中心</h1>
            <p class="page-subtitle">管理您的Aurora账户和数据</p>
            
            <!-- 统计信息 -->
            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-number" id="emotion-count">-</div>
                    <div class="stat-label">情感分析次数</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="stat-number" id="chat-count">-</div>
                    <div class="stat-label">对话会话数</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-number" id="join-days">-</div>
                    <div class="stat-label">加入天数</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-sync"></i>
                    </div>
                    <div class="stat-number" id="last-sync">-</div>
                    <div class="stat-label">最后同步</div>
                </div>
            </div>
            
            <!-- 功能区域 -->
            <div class="features-grid">
                <div class="feature-card" onclick="openModal('preferences')">
                    <div class="feature-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="feature-title">偏好设置</div>
                    <div class="feature-description">
                        自定义您的Aurora体验，包括主题、语言、通知等设置。
                    </div>
                    <button class="feature-btn">管理设置</button>
                </div>
                
                <div class="feature-card" onclick="openModal('privacy')">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="feature-title">隐私设置</div>
                    <div class="feature-description">
                        控制您的数据使用方式，保护您的隐私和安全。
                    </div>
                    <button class="feature-btn">隐私管理</button>
                </div>
                
                <div class="feature-card" onclick="openModal('data')">
                    <div class="feature-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="feature-title">数据管理</div>
                    <div class="feature-description">
                        查看、导出或删除您的个人数据。
                    </div>
                    <button class="feature-btn">数据管理</button>
                </div>
                
                <div class="feature-card" onclick="syncData()">
                    <div class="feature-icon">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="feature-title">数据同步</div>
                    <div class="feature-description">
                        同步您的数据到云端，确保数据安全。
                    </div>
                    <button class="feature-btn">立即同步</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 偏好设置模态框 -->
    <div class="modal" id="preferences-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">偏好设置</h2>
                <button class="close-modal" onclick="closeModal('preferences')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">主题</label>
                    <select id="theme-select" style="width: 100%; padding: 10px; background: var(--glass-medium); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--pure-white);">
                        <option value="dark">深色主题</option>
                        <option value="light">浅色主题</option>
                        <option value="auto">自动</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">语言</label>
                    <select id="language-select" style="width: 100%; padding: 10px; background: var(--glass-medium); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--pure-white);">
                        <option value="zh-CN">简体中文</option>
                        <option value="en-US">English</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">
                        <input type="checkbox" id="notifications-check" style="margin-right: 10px;">
                        启用通知
                    </label>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">隐私级别</label>
                    <select id="privacy-level-select" style="width: 100%; padding: 10px; background: var(--glass-medium); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--pure-white);">
                        <option value="standard">标准</option>
                        <option value="strict">严格</option>
                        <option value="relaxed">宽松</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('preferences')">取消</button>
                <button class="btn btn-primary" onclick="savePreferences()">保存</button>
            </div>
        </div>
    </div>

    <!-- 隐私设置模态框 -->
    <div class="modal" id="privacy-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">隐私设置</h2>
                <button class="close-modal" onclick="closeModal('privacy')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">
                        <input type="checkbox" id="data-sharing-check" style="margin-right: 10px;">
                        允许数据共享（用于改进服务）
                    </label>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">
                        <input type="checkbox" id="analytics-check" style="margin-right: 10px;">
                        启用使用分析
                    </label>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">
                        <input type="checkbox" id="personalized-ads-check" style="margin-right: 10px;">
                        个性化广告
                    </label>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--neural-silver); font-family: var(--font-mono); font-size: 14px;">数据保留期</label>
                    <select id="data-retention-select" style="width: 100%; padding: 10px; background: var(--glass-medium); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--pure-white);">
                        <option value="30">30天</option>
                        <option value="90">90天</option>
                        <option value="365">1年</option>
                        <option value="never">永久保留</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('privacy')">取消</button>
                <button class="btn btn-primary" onclick="savePrivacySettings()">保存</button>
            </div>
        </div>
    </div>

    <!-- 数据管理模态框 -->
    <div class="modal" id="data-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">数据管理</h2>
                <button class="close-modal" onclick="closeModal('data')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--pure-white); font-family: var(--font-grotesk); font-size: 18px; margin-bottom: 15px;">数据概览</h3>
                    <div style="background: var(--glass-medium); border: 1px solid var(--glass-border); border-radius: 10px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--neural-silver);">情感记录:</span>
                            <span style="color: var(--pure-white);" id="data-emotion-count">-</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--neural-silver);">对话会话:</span>
                            <span style="color: var(--pure-white);" id="data-chat-count">-</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--neural-silver);">最后同步:</span>
                            <span style="color: var(--pure-white);" id="data-last-sync">-</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--pure-white); font-family: var(--font-grotesk); font-size: 18px; margin-bottom: 15px;">数据操作</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                        <button class="btn btn-secondary" onclick="syncData()">
                            <i class="fas fa-sync"></i> 同步数据
                        </button>
                        <button class="btn btn-danger" onclick="deleteData()">
                            <i class="fas fa-trash"></i> 删除数据
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('data')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script src="js/auth-manager.js"></script>
    <script>
        let userStats = null;
        let userData = null;

        // 检查用户是否已登录
        if (!window.authManager.isAuthenticated()) {
            window.location.href = 'login.html';
        }

        // 页面加载时获取用户数据
        window.addEventListener('load', async () => {
            try {
                await loadUserData();
                await loadUserStats();
                updateStatsDisplay();
            } catch (error) {
                console.error('加载用户数据失败:', error);
                showNotification('加载用户数据失败', 'error');
            }
        });

        // 加载用户数据
        async function loadUserData() {
            try {
                userData = await window.authManager.getUserData();
                console.log('用户数据加载成功:', userData);
            } catch (error) {
                console.error('获取用户数据失败:', error);
                // 尝试使用本地数据
                userData = window.authManager.getLocalUserData();
                if (!userData) {
                    throw new Error('无法获取用户数据');
                }
            }
        }

        // 加载用户统计信息
        async function loadUserStats() {
            try {
                userStats = await window.authManager.getUserStats();
                console.log('用户统计信息加载成功:', userStats);
            } catch (error) {
                console.error('获取用户统计信息失败:', error);
                // 使用本地数据计算统计信息
                if (userData) {
                    userStats = {
                        emotionCount: userData.emotionHistory ? userData.emotionHistory.length : 0,
                        chatCount: userData.chatSessions ? userData.chatSessions.length : 0,
                        lastSync: userData.lastSync || '从未同步'
                    };
                }
            }
        }

        // 更新统计信息显示
        function updateStatsDisplay() {
            if (userStats) {
                document.getElementById('emotion-count').textContent = userStats.emotionCount || 0;
                document.getElementById('chat-count').textContent = userStats.chatCount || 0;
                document.getElementById('join-days').textContent = calculateJoinDays();
                document.getElementById('last-sync').textContent = formatLastSync(userStats.lastSync);
                
                // 更新数据管理模态框中的信息
                document.getElementById('data-emotion-count').textContent = userStats.emotionCount || 0;
                document.getElementById('data-chat-count').textContent = userStats.chatCount || 0;
                document.getElementById('data-last-sync').textContent = formatLastSync(userStats.lastSync);
            }
        }

        // 计算加入天数
        function calculateJoinDays() {
            if (userData && userData.preferences) {
                // 这里应该从用户创建时间计算，暂时返回一个示例值
                return Math.floor(Math.random() * 365) + 1;
            }
            return 0;
        }

        // 格式化最后同步时间
        function formatLastSync(lastSync) {
            if (!lastSync || lastSync === '从未同步') {
                return '从未同步';
            }
            
            try {
                const date = new Date(lastSync);
                const now = new Date();
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return '今天';
                } else if (diffDays === 1) {
                    return '昨天';
                } else if (diffDays < 7) {
                    return `${diffDays}天前`;
                } else {
                    return date.toLocaleDateString('zh-CN');
                }
            } catch (error) {
                return '未知';
            }
        }

        // 打开模态框
        function openModal(type) {
            const modal = document.getElementById(`${type}-modal`);
            if (modal) {
                modal.classList.add('show');
                loadModalData(type);
            }
        }

        // 关闭模态框
        function closeModal(type) {
            const modal = document.getElementById(`${type}-modal`);
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // 加载模态框数据
        function loadModalData(type) {
            if (!userData) return;

            switch (type) {
                case 'preferences':
                    if (userData.preferences) {
                        document.getElementById('theme-select').value = userData.preferences.theme || 'dark';
                        document.getElementById('language-select').value = userData.preferences.language || 'zh-CN';
                        document.getElementById('notifications-check').checked = userData.preferences.notifications !== false;
                        document.getElementById('privacy-level-select').value = userData.preferences.privacy || 'standard';
                    }
                    break;
                    
                case 'privacy':
                    if (userData.privacySettings) {
                        document.getElementById('data-sharing-check').checked = userData.privacySettings.dataSharing || false;
                        document.getElementById('analytics-check').checked = userData.privacySettings.analytics !== false;
                        document.getElementById('personalized-ads-check').checked = userData.privacySettings.personalizedAds || false;
                        document.getElementById('data-retention-select').value = userData.privacySettings.dataRetention || '90';
                    }
                    break;
            }
        }

        // 保存偏好设置
        async function savePreferences() {
            try {
                const preferences = {
                    theme: document.getElementById('theme-select').value,
                    language: document.getElementById('language-select').value,
                    notifications: document.getElementById('notifications-check').checked,
                    privacy: document.getElementById('privacy-level-select').value
                };

                await window.authManager.updateUserPreferences(preferences);
                showNotification('偏好设置保存成功', 'success');
                closeModal('preferences');
                
                // 重新加载数据
                await loadUserData();
            } catch (error) {
                console.error('保存偏好设置失败:', error);
                showNotification('保存偏好设置失败', 'error');
            }
        }

        // 保存隐私设置
        async function savePrivacySettings() {
            try {
                const privacySettings = {
                    dataSharing: document.getElementById('data-sharing-check').checked,
                    analytics: document.getElementById('analytics-check').checked,
                    personalizedAds: document.getElementById('personalized-ads-check').checked,
                    dataRetention: document.getElementById('data-retention-select').value
                };

                await window.authManager.updateUserPrivacySettings(privacySettings);
                showNotification('隐私设置保存成功', 'success');
                closeModal('privacy');
                
                // 重新加载数据
                await loadUserData();
            } catch (error) {
                console.error('保存隐私设置失败:', error);
                showNotification('保存隐私设置失败', 'error');
            }
        }

        // 同步数据
        async function syncData() {
            try {
                showNotification('正在同步数据...', 'info');
                const result = await window.authManager.syncUserData();
                showNotification(`数据同步完成 (${result.source})`, 'success');
                
                // 重新加载数据
                await loadUserData();
                await loadUserStats();
                updateStatsDisplay();
            } catch (error) {
                console.error('数据同步失败:', error);
                showNotification('数据同步失败', 'error');
            }
        }

        // 导出数据
        async function exportData() {
            try {
                const exportData = await window.authManager.exportUserData();
                
                // 创建下载链接
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `aurora-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showNotification('数据导出成功', 'success');
            } catch (error) {
                console.error('导出数据失败:', error);
                showNotification('导出数据失败', 'error');
            }
        }

        // 删除数据
        async function deleteData() {
            if (confirm('确定要删除所有数据吗？此操作不可恢复！')) {
                try {
                    await window.authManager.deleteUserData();
                    showNotification('数据删除成功', 'success');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                } catch (error) {
                    console.error('删除数据失败:', error);
                    showNotification('删除数据失败', 'error');
                }
            }
        }

        // 登出
        function logout() {
            window.authManager.logout();
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(0, 255, 127, 0.1)' : 
                           type === 'error' ? 'rgba(255, 42, 109, 0.1)' : 
                           'rgba(0, 191, 255, 0.1)'};
                border: 1px solid ${type === 'success' ? 'rgba(0, 255, 127, 0.3)' : 
                                  type === 'error' ? 'rgba(255, 42, 109, 0.3)' : 
                                  'rgba(0, 191, 255, 0.3)'};
                border-radius: 10px;
                padding: 15px 20px;
                color: var(--pure-white);
                font-family: var(--font-display);
                font-size: 14px;
                z-index: 3000;
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // 添加CSS动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100%);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            
            @keyframes slideOutRight {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
